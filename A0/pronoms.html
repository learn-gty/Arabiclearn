<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Apprentissage des Pronoms Arabes</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <style>
:root {
  --pal-red: #E4312b;
  --pal-black: #000;
  --pal-white: #fff;
  --pal-green: #149954;
  --container-bg: rgba(255,255,255,0.98);
  --container-border: #ddd;
  --button-bg: var(--pal-black);
  --button-text: var(--pal-white);
  --button-hover-bg: var(--pal-red);
  --button-hover-text: var(--pal-white);
  --stats-bg: #f4f4f4;
}

body.dark-mode {
  --container-bg: rgba(24,24,24,0.96);
  --container-border: #444;
  --button-bg: var(--pal-black);
  --button-text: var(--pal-white);
  --button-hover-bg: var(--pal-red);
  --button-hover-text: var(--pal-white);
  --stats-bg: #232323;
}

body {
  min-height: 100vh;
  font-family: 'Quicksand', Arial, sans-serif;
  background:
    linear-gradient(to bottom, var(--pal-black) 0 33%, var(--pal-white) 33% 66%, var(--pal-green) 66% 100%),
    linear-gradient(135deg, var(--pal-red) 0 32%, transparent 32% 100%);
  color: var(--pal-black);
  margin: 0;
  padding: 0;
  line-height: 1.1;
}

body::before {
  content: "";
  position: fixed;
  top: 0; left: 0;
  width: 30vw; height: 100vh;
  background: var(--pal-red);
  clip-path: polygon(0 0, 100% 50%, 0 100%);
  z-index: 0;
  opacity: 0.7;
  pointer-events: none;
}

.container {
  position: relative;
  z-index: 1;
  max-width: 520px;
  width: 99vw;
  margin: 10px auto 0 auto;
  background: var(--container-bg);
  border-radius: 8px;
  box-shadow: 0 0 6px rgba(0,0,0,0.08);
  padding: 7px 4px 8px 4px;
  border: 1px solid var(--container-border);
  display: flex;
  flex-direction: column;
}

h1 {
  font-weight: 700;
  font-size: 1.05rem;
  margin-bottom: 0.2rem;
  color: var(--pal-red);
  text-align: center;
  letter-spacing: 0.5px;
}

.top-bar {
  display: flex;
  justify-content: flex-end;
  gap: 4px;
  margin-bottom: 0.2rem;
  flex-wrap: wrap;
}

.top-bar button {
  background-color: var(--button-bg);
  color: var(--button-text);
  border: 1px solid var(--pal-red);
  padding: 2px 7px;
  border-radius: 3px;
  font-size: 0.83rem;
  min-height: 22px;
  min-width: 38px;
  cursor: pointer;
  transition: background-color 0.18s, color 0.18s, border 0.18s;
  white-space: nowrap;
  line-height: 1;
}
.top-bar button:hover {
  background-color: var(--button-hover-bg);
  color: var(--button-hover-text);
  border: 1px solid var(--pal-green);
}

.theme-switch {
  position: absolute;
  top: 6px;
  left: 6px;
  display: flex;
  align-items: center;
  gap: 3px;
  color: var(--pal-red);
  font-weight: 700;
  cursor: pointer;
  z-index: 2;
  font-size: 0.82rem;
}

.theme-switch input[type="checkbox"] {
  width: 18px;
  height: 10px;
  accent-color: var(--pal-red);
  cursor: pointer;
  margin: 0;
}

.mode-options, .delay-options {
  display: flex;
  flex-wrap: wrap;
  gap: 3px;
  margin-bottom: 0.15rem;
  font-size: 0.87rem;
  align-items: center;
}

.mode-btn, .delay-btn {
  background-color: var(--button-bg);
  color: var(--button-text);
  border: 1px solid var(--pal-black);
  border-radius: 3px;
  padding: 1px 6px;
  cursor: pointer;
  font-size: 0.8rem;
  min-width: 32px;
  min-height: 18px;
  line-height: 1;
  white-space: nowrap;
}
.mode-btn.active, .delay-btn.active {
  background-color: var(--pal-green);
  color: #fff;
  border: 1px solid var(--pal-green);
}
.mode-btn:hover:not(.active), .delay-btn:hover:not(.active) {
  background-color: var(--pal-red);
  color: var(--pal-white);
  border: 1px solid var(--pal-red);
}

.question-area {
  margin: 0.15rem 0 0.1rem 0;
  min-height: 18px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
.question-text {
  font-size: 0.98rem;
  font-weight: 600;
  margin-bottom: 0.12rem;
  text-align: center;
  color: var(--pal-black);
  min-height: 14px;
  transition: color 0.3s;
  line-height: 1.1;
}
body.dark-mode .question-text {
  color: var(--pal-white);
}

.answer-area {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.answer-area input[type="text"] {
  width: 94%;
  max-width: 220px;
  padding: 3px 7px;
  border-radius: 4px;
  border: 1px solid var(--pal-black);
  font-size: 0.9rem;
  font-weight: 500;
  color: var(--pal-black);
  background: var(--container-bg);
  transition: border-color 0.3s, background 0.3s, color 0.3s;
  line-height: 1.1;
}
body.dark-mode .answer-area input[type="text"] {
  color: var(--pal-white);
  border-color: var(--pal-white);
  background: #232323;
}
.answer-area input[type="text"]:focus {
  border-color: var(--pal-green);
  outline: none;
}
.choices-list {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 2px;
  margin-bottom: 0.1rem;
}
.choices-list label {
  cursor: pointer;
  font-weight: 600;
  font-size: 0.87rem;
  display: flex;
  align-items: center;
  gap: 3px;
  color: var(--pal-black);
  line-height: 1.1;
}
body.dark-mode .choices-list label {
  color: var(--pal-white);
}
.choices-list input[type="checkbox"] {
  accent-color: var(--pal-red);
  transform: scale(0.95);
  cursor: pointer;
  margin: 0;
}

.feedback {
  font-weight: 700;
  min-height: 16px;
  margin-bottom: 0.15rem;
  text-align: center;
  font-size: 0.85rem;
  transition: color 0.3s;
  line-height: 1.1;
}
.feedback.good { color: var(--pal-green); }
.feedback.bad { color: var(--pal-red); }

.controls {
  display: flex;
  gap: 6px;
  justify-content: center;
  margin-top: 4px;
  flex-wrap: wrap;
}
.validate-btn, .next-btn, .continue-btn {
  background-color: var(--button-bg);
  color: var(--button-text);
  border: 1px solid var(--pal-black);
  border-radius: 4px;
  padding: 2px 11px;
  font-size: 0.85rem;
  min-height: 20px;
  min-width: 38px;
  cursor: pointer;
  transition: background-color 0.18s, color 0.18s, border 0.18s;
  white-space: nowrap;
  line-height: 1;
}
.validate-btn:disabled, .next-btn:disabled, .continue-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
.validate-btn:hover:not(:disabled), .next-btn:hover:not(:disabled), .continue-btn:hover:not(:disabled) {
  background-color: var(--pal-red);
  color: var(--pal-white);
  border: 1px solid var(--pal-red);
}

.stats-bar {
  display: flex;
  gap: 6px;
  justify-content: center;
  margin: 0.2rem 0 0.3rem 0;
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--pal-black);
  flex-wrap: wrap;
  line-height: 1.1;
}
body.dark-mode .stats-bar { color: var(--pal-white); }
.stats-bar span {
  background: var(--stats-bg);
  padding: 2px 7px;
  border-radius: 4px;
  min-width: 48px;
  text-align: center;
}

.level-bar {
  width: 100%;
  height: 10px;
  border-radius: 6px;
  background: #ddd;
  overflow: hidden;
  margin-bottom: 0.2rem;
}
body.dark-mode .level-bar { background: #444; }
.level-progress {
  height: 100%;
  background-color: var(--pal-green);
  width: 0%;
  transition: width 0.5s;
}

.popup {
  position: fixed;
  top: 6vh;
  left: 50%;
  transform: translateX(-50%);
  background: var(--container-bg);
  color: var(--pal-black);
  border: 1px solid var(--pal-red);
  box-shadow: 0 4px 14px rgba(0,0,0,0.16);
  border-radius: 8px;
  z-index: 1001;
  min-width: 180px;
  max-width: 98vw;
  max-height: 90vh;
  overflow: auto;
  padding: 8px 4px 4px 4px;
  cursor: move;
  display: none;
  font-size: 0.9rem;
}
body.dark-mode .popup { color: var(--pal-white); }
.popup .close-btn {
  position: absolute;
  top: 4px;
  right: 8px;
  background: none;
  border: none;
  font-size: 18px;
  color: var(--pal-red);
  cursor: pointer;
  font-weight: 700;
}
.popup-title {
  font-size: 1.05rem;
  font-weight: 700;
  text-align: center;
  margin-bottom: 0.3rem;
  color: var(--pal-red);
}
.pronoun-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 0.2rem;
  font-size: 0.85rem;
}
.pronoun-table th, .pronoun-table td {
  border: 1px solid #ccc;
  padding: 2px 5px;
  text-align: center;
  font-weight: 600;
  line-height: 1.1;
}
.pronoun-table th {
  background-color: var(--pal-red);
  color: var(--pal-white);
}
.pronoun-table tr:nth-child(even) { background-color: #f9f9f9; }
body.dark-mode .pronoun-table th {
  background-color: var(--pal-red);
  color: var(--pal-white);
}
body.dark-mode .pronoun-table tr:nth-child(even) { background-color: #232323; }

/* Responsive design */
@media (max-width: 768px) {
  .container {
    max-width: 100vw;
    padding: 4px 2vw 7px 2vw;
    margin: 2vw auto 0 auto;
  }
  .top-bar { justify-content: center; }
  .mode-options, .delay-options { justify-content: center; }
  .controls { flex-direction: column; gap: 4px; }
  .validate-btn, .next-btn, .continue-btn { width: 100%; }
  .popup { min-width: 0; max-width: 99vw; top: 2vh; padding: 6px 2vw 6px 2vw; }
}

.choices-grid {
  display: grid;
  gap: 1px 2px;
  margin: 2px 0;
  align-items: start;
}

.choice-item {
  display: flex;
  align-items: center;
  padding: 1px 2px;
  font-size: 0.85em;
  cursor: pointer;
  white-space: normal;
  line-height: 1.1;
}

body.dark-mode .choices-list label,
body.dark-mode .choice-item {
  color: #fff !important;
  background: transparent; /* ou une couleur sombre si besoin */
}

.menu-hamburger {
  position: fixed;
  top: 1rem;
  left: 1rem;
  z-index: 1100;
}

.menu-icon {
  display: flex;
  flex-direction: column;
  justify-content: center;
  width: 40px;
  height: 40px;
  cursor: pointer;
  transition: transform 0.3s ease;
}

.menu-icon span {
  height: 3px;
  width: 100%;
  background-color: #333;
  margin: 5px 0;
  border-radius: 2px;
  transition: 0.4s ease;
}

#menu-toggle {
  display: none;
}

/* Menu lat√©ral moderne */
.menu {
  position: fixed;
  top: 0;
  left: -260px;
  width: 240px;
  height: 100vh;
  background: #ffffff;
  box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
  border-top-right-radius: 16px;
  border-bottom-right-radius: 16px;
  padding: 60px 0 20px 0;
  list-style: none;
  transition: left 0.35s ease;
  font-family: 'Segoe UI', Arial, sans-serif;
  overflow-y: auto;
}

.menu li {
  margin: 0;
  padding: 0;
}

.menu li a {
  display: block;
  padding: 14px 24px;
  color: #333;
  font-size: 1rem;
  text-decoration: none;
  border-left: 4px solid transparent;
  transition: background-color 0.25s, border-color 0.25s;
}

.menu li a:hover {
  background-color: #f5f5f5;
  color: #007a33;
  border-left: 4px solid #007a33;
}

/* Menu visible quand le toggle est activ√© */
#menu-toggle:checked ~ .menu {
  left: 0;
}

/* Animation du bouton hamburger ‚Üí X */
#menu-toggle:checked + .menu-icon span:nth-child(1) {
  transform: rotate(45deg) translate(5px, 5px);
}
#menu-toggle:checked + .menu-icon span:nth-child(2) {
  opacity: 0;
}
#menu-toggle:checked + .menu-icon span:nth-child(3) {
  transform: rotate(-45deg) translate(5px, -5px);
}

/* Responsive am√©lior√© */
@media (max-width: 600px) {
  .menu {
    width: 80vw;
    max-width: 300px;
    border-radius: 0 16px 16px 0;
  }

  .menu li a {
    font-size: 0.95rem;
    padding: 12px 20px;
  }

  .menu-icon {
    width: 36px;
    height: 36px;
  }

  .menu-icon span {
    margin: 4px 0;
  }


    #content-wrapper {
    z-index: 0;
    position: relative;
  }

 

  #loader-overlay {
    z-index: 10000;
  }
}



  </style>
</head>
<body>
    <!-- Menu Hamburger Responsive -->
<nav class="menu-hamburger">
  <input type="checkbox" id="menu-toggle" />
  <label for="menu-toggle" class="menu-icon">
    <span></span>
    <span></span>
    <span></span>
  </label>
 <ul class="menu">
    <li><a href="../index.html">Accueil</a></li>
    <li><a href="ar50.html">S√©quences & Le√ßons</a></li>
    <li><a href="pronoms.html">Pronoms</a></li>
    <li><a href="pronomsPossessifs.html">Possessifs</a></li>
    <li><a href="LunaireSolaire.html">Lettres Lunaires/Solaires</a></li>
    <li><a href="chiffres.3.html">Exercice Chiffres </a></li>
    <li><a href="ChiffresEx.3.4.html">Autres Exercice Chiffres</a></li> 
    <li><a href="Verb.1.1.html">Conjugaison (1er verbes)</a></li> 
    <li><a href="PageUnderConstruction.html">Suite...</a></li> </ul>
</nav>

  <div class="container">
    <div class="theme-switch">
      <input type="checkbox" id="theme-toggle">
      <label for="theme-toggle" style="cursor:pointer;">üåô</label>
      <button id="silent-btn" onclick="toggleSilentMode()">üîä</button>

    </div>
    <h1>Apprentissage des Pronoms Arabes</h1>
    <div class="top-bar">
      <button id="show-table-btn">Tableau des pronoms</button>
      <button id="show-stats-btn">Statistiques</button>
    </div>
    <div style="margin-bottom:16px;">
      <div style="font-weight:bold;">Mode d'apprentissage :</div>
      <div class="mode-options">
        <button class="mode-btn active" data-mode="fr-ar">Fran√ßais ‚Üí Arabe</button>
        <button class="mode-btn" data-mode="ar-fr">Arabe ‚Üí Fran√ßais</button>
        <button class="mode-btn" data-mode="fr-tr">Fran√ßais ‚Üí Translitt√©ration</button>
        <button class="mode-btn" data-mode="tr-fr">Translitt√©ration ‚Üí Fran√ßais</button>
        <button class="mode-btn" data-mode="ar-tr">Arabe ‚Üí Translitt√©ration</button>
        <button class="mode-btn" data-mode="tr-ar">Translitt√©ration ‚Üí Arabe</button>
        <button class="mode-btn" data-mode="quiz-appr">Quiz (par apprentissage)</button>
        <button class="mode-btn" data-mode="quiz-global">Quiz (global)</button>
      </div>
      <div style="font-weight:bold;">D√©lai r√©ponse :</div>
      <div class="delay-options">
        <button class="delay-btn active" data-delay="2">2 sec</button>
        <button class="delay-btn" data-delay="4">4 sec</button>
        <button class="delay-btn" data-delay="8">8 sec</button>
        <button class="delay-btn" data-delay="300">5 minutes</button>
      </div>
    </div>
    <div class="level-bar"><div class="level-progress" id="level-progress" style="width:0%"></div></div>
    <div class="stats-bar">
      <span>Bonnes : <b id="good-count">0</b></span>
      <span>Mauvaises : <b id="bad-count">0</b></span>
      <span>Niveau : <b id="level-label">D√©butant</b></span>
      <span>Pr√©cision : <b id="accuracy-label">0%</b></span>
    </div>
    <div class="question-area">
      <div class="question-text" id="question-text"></div>
      <div class="answer-area" id="answer-area"></div>
      <div class="feedback" id="feedback"></div>
      <div class="controls">
        <button class="validate-btn" id="validate-btn">Valider</button>
        <button class="next-btn" id="next-btn">Question suivante</button>
        <button class="next-btn" id="continue-btn" style="display:none;">Continuer</button>
      </div>
    </div>
  </div>

  <!-- Popup Tableau des pronoms -->
  <div class="popup" id="table-popup">
    <button class="close-btn" onclick="closePopup('table-popup')">&times;</button>
    <div class="popup-title">Tableau des pronoms</div>
    <table class="pronoun-table">
      <thead>
        <tr><th>Fran√ßais</th><th>Arabe</th></tr>
      </thead>
      <tbody id="pronoun-table-body"></tbody>
    </table>
  </div>
  <!-- Popup Statistiques -->
  <div class="popup" id="stats-popup">
    <button class="close-btn" onclick="closePopup('stats-popup')">&times;</button>
    <div class="popup-title">Statistiques</div>
    <div class="popup-btns">
      <button id="export-csv-btn">Exporter CSV</button>
      <button id="export-json-btn">Exporter JSON</button>
      <button id="import-json-btn">Importer JSON</button>
      <input type="file" id="import-json-input" accept="application/json" style="display:none;">
    </div>
    <div>
      <canvas id="chart" width="340" height="180"></canvas>
    </div>
    <div style="margin-top:10px;">
      <span>Bonnes : <b id="stat-good">0</b></span> | 
      <span>Mauvaises : <b id="stat-bad">0</b></span> | 
      <span>Pr√©cision : <b id="stat-acc">0%</b></span>
    </div>
  </div>

  <!-- Sons -->
  <audio id="good-audio" src="data:audio/wav;base64,UklGRhQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YYwAAAD/AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA" preload="auto"></audio>
  <audio id="bad-audio" src="data:audio/wav;base64,UklGRhQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YYwAAAD/AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA" preload="auto"></audio>

  <!-- Chart.js (CDN pour d√©mo, √† remplacer par inline pour version 100% offline) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>




    const pronouns = [
      { fr: "je", ar: "ÿ£ŸÜÿß", tr: "ana" },
      { fr: "tu (m)", ar: "ÿ£ŸÜÿ™Ÿé", tr: "anta" },
      { fr: "tu (f)", ar: "ÿ£ŸÜÿ™Ÿê", tr: "anti" },
      { fr: "il", ar: "ŸáŸà", tr: "huwa" },
      { fr: "elle", ar: "ŸáŸä", tr: "hiya" },
      { fr: "nous", ar: "ŸÜÿ≠ŸÜ", tr: "nahnu" },
      { fr: "vous (m)", ar: "ÿ£ŸÜÿ™ŸÖ", tr: "antum" },
      { fr: "vous (f)", ar: "ÿ£ŸÜÿ™ŸÜŸë", tr: "antunna" },
      { fr: "ils", ar: "ŸáŸÖ", tr: "hum" },
      { fr: "elles", ar: "ŸáŸÜŸë", tr: "hunna" },
      { fr: "vous (m) dual", ar: "ÿ£ŸÜÿ™ŸÖÿß", tr: "antuma" },
      { fr: "vous (f) dual", ar: "ÿ£ŸÜÿ™ŸÖÿß", tr: "antuma" },
      { fr: "ils (dual)", ar: "ŸáŸÖÿß", tr: "huma" },
      { fr: "elles (dual)", ar: "ŸáŸÖÿß", tr: "huma" }
    ];
    const choiceModes = ["fr-ar", "fr-tr", "ar-tr", "tr-ar"];
    const quizModes = ["fr-ar", "ar-fr", "fr-tr", "tr-fr", "ar-tr", "tr-ar"];
    const levelThresholds = [
      { label: "D√©butant", min: 0 },
      { label: "Interm√©diaire", min: 10 },
      { label: "Avanc√©", min: 25 },
      { label: "Expert", min: 50 }
    ];
    let stats = JSON.parse(localStorage.getItem("pronoun_stats")||"null") || {
      good: 0, bad: 0, history: []
    };
    let currentMode = "fr-ar";
    let currentQuizSubMode = null;
    let currentDelay = 2;
    let currentQuestion = null;
    let currentChoices = [];
    let waitingNext = false;
    let chart = null;

    document.addEventListener("DOMContentLoaded", () => {
      const themeToggle = document.getElementById("theme-toggle");
      if(localStorage.getItem("pronoun_theme")==="dark") {
        document.body.classList.add("dark-mode");
        themeToggle.checked = true;
      }
      themeToggle.addEventListener("change", () => {
        document.body.classList.toggle("dark-mode");
        localStorage.setItem("pronoun_theme", document.body.classList.contains("dark-mode") ? "dark" : "light");
      });

      fillPronounTable();
      makePopupDraggable("table-popup");
      makePopupDraggable("stats-popup");
      document.getElementById("show-table-btn").onclick = () => openPopup("table-popup");
      document.getElementById("show-stats-btn").onclick = () => { openPopup("stats-popup"); drawChart(); updateStatsPopup(); };

      document.querySelectorAll(".mode-btn").forEach(btn => {
        btn.onclick = () => {
          document.querySelectorAll(".mode-btn").forEach(b=>b.classList.remove("active"));
          btn.classList.add("active");
          currentMode = btn.dataset.mode;
          currentQuizSubMode = null;
          nextQuestion();
        };
      });
      document.querySelectorAll(".delay-btn").forEach(btn => {
        btn.onclick = () => {
          document.querySelectorAll(".delay-btn").forEach(b=>b.classList.remove("active"));
          btn.classList.add("active");
          currentDelay = parseInt(btn.dataset.delay,10);
        };
      });

      document.getElementById("validate-btn").onclick = validateCurrent;
      document.getElementById("next-btn").onclick = nextQuestion;
      document.getElementById("continue-btn").onclick = nextQuestion;

      window.onclick = function(e){
        ["table-popup","stats-popup"].forEach(id=>{
          const pop=document.getElementById(id);
          if(pop.style.display==="block" && !pop.contains(e.target) && !e.target.matches("#show-table-btn,#show-stats-btn")) closePopup(id);
        });
      };

      document.getElementById("export-csv-btn").onclick = exportCSV;
      document.getElementById("export-json-btn").onclick = exportJSON;
      document.getElementById("import-json-btn").onclick = ()=>document.getElementById("import-json-input").click();
      document.getElementById("import-json-input").onchange = importJSON;

      updateStatsBar();
      nextQuestion();
    });

    function fillPronounTable() {
      let html = "";
      pronouns.forEach(p=>{
        html += `<tr><td>${p.fr}</td><td>${p.ar}</td></tr>`;
      });
      document.getElementById("pronoun-table-body").innerHTML = html;
    }
    function makePopupDraggable(id){
      const el=document.getElementById(id);
      let isDown=false,dx=0,dy=0;
      el.onmousedown = function(e){
        if(e.target.classList.contains("close-btn")) return;
        isDown = true;
        dx = e.clientX - el.offsetLeft;
        dy = e.clientY - el.offsetTop;
        document.onmousemove = function(e2){
          if(isDown){
            el.style.left = (e2.clientX - dx) + "px";
            el.style.top = (e2.clientY - dy) + "px";
            el.style.transform = "none";
          }
        }
        document.onmouseup = ()=>{isDown=false;document.onmousemove=null;};
      };
    }
    function openPopup(id){document.getElementById(id).style.display="block";}
    function closePopup(id){document.getElementById(id).style.display="none";}

    function nextQuestion(){
      waitingNext = false;
      document.getElementById("feedback").textContent = "";
      document.getElementById("validate-btn").disabled = false;
      document.getElementById("next-btn").disabled = false;
      document.getElementById("continue-btn").style.display = "none";
      document.getElementById("next-btn").style.display = "";

      let mode = currentMode;
      if(mode==="quiz-appr"){
        mode = quizModes[Math.floor(Math.random()*quizModes.length)];
        currentQuizSubMode = mode;
      } else if(mode==="quiz-global"){
        mode = quizModes[Math.floor(Math.random()*quizModes.length)];
        currentQuizSubMode = mode;
      } else {
        currentQuizSubMode = null;
      }
      currentQuestion = pronouns[Math.floor(Math.random()*pronouns.length)];
      showQuestion(mode, currentQuestion);
      if(currentDelay>0 && !isChoiceMode(mode)){
        setTimeout(()=>{
          if(!waitingNext && document.getElementById("feedback").textContent===""){
            showAnswerArea(false,true);
          }
        }, currentDelay*1000);
      }
    }

    function showQuestion(mode, q){
      const qel = document.getElementById("question-text");
      qel.classList.remove("fade-in","fade-out");
      void qel.offsetWidth;
      qel.classList.add("fade-out");
      setTimeout(()=>{
        let label = "";
        if(mode==="fr-ar") label = `Comment dit-on "<b>${q.fr}</b>" en arabe‚ÄØ?`;
        else if(mode==="ar-fr") label = `Que signifie "<b>${q.ar}</b>" en fran√ßais‚ÄØ?`;
        else if(mode==="fr-tr") label = `Quelle est la translitt√©ration de "<b>${q.fr}</b>"‚ÄØ?`;
        else if(mode==="tr-fr") label = `√Ä quel pronom fran√ßais correspond "<b>${q.tr}</b>"‚ÄØ?`;
        else if(mode==="ar-tr") label = `Quelle est la translitt√©ration de "<b>${q.ar}</b>"‚ÄØ?`;
        else if(mode==="tr-ar") label = `Comment √©crit-on "<b>${q.tr}</b>" en arabe‚ÄØ?`;
        else label = "Question";
        qel.innerHTML = label;
        qel.classList.remove("fade-out");
        qel.classList.add("fade-in");
        showAnswerArea(mode, q);
      },350);
    }

   function showAnswerArea(mode, q) {
  const area = document.getElementById("answer-area");
  area.innerHTML = "";
  currentChoices = [];

  // Fonction utilitaire pour d√©terminer le nombre de colonnes selon la largeur de la fen√™tre
  function getColumnCount() {
    const width = window.innerWidth;
    if (width < 600) return 1;      // Mobile : 1 colonne
    if (width < 900) return 2;      // Tablette : 2 colonnes
    if (width < 1200) return 3;     // Petit desktop : 3 colonnes
    return 4;                       // Grand √©cran : 4 colonnes
  }

  if (isChoiceMode(mode)) {
    let choices = getChoicesForMode(mode);
    choices = shuffle([...choices]);
    currentChoices = choices;

    // G√©n√®re la structure HTML avec une classe pour le grid
    let html = `<div class="choices-grid" id="choices-list">`;
    choices.forEach((val, i) => {
      html += `
        <label class="choice-item">
          <input type="checkbox" name="choice" value="${val}" id="choice${i}"> ${val}
        </label>`;
    });
    html += `</div>`;
    area.innerHTML = html;

    // Applique dynamiquement le nombre de colonnes
    function updateGridColumns() {
      const colCount = getColumnCount();
      const grid = document.getElementById("choices-list");
      if (grid) {
        grid.style.gridTemplateColumns = `repeat(${colCount}, 1fr)`;
      }
    }
    updateGridColumns();
    window.addEventListener('resize', updateGridColumns);

    // Affichage des boutons
    document.getElementById("validate-btn").style.display = "";
    document.getElementById("validate-btn").disabled = false;
    document.getElementById("next-btn").style.display = "";
    document.getElementById("continue-btn").style.display = "none";

    // Un seul checkbox s√©lectionnable √† la fois
    document.querySelectorAll('input[type="checkbox"][name="choice"]').forEach(cb => {
      cb.addEventListener('change', function () {
        if (this.checked) {
          document.querySelectorAll('input[type="checkbox"][name="choice"]').forEach(other => {
            if (other !== this) other.checked = false;
          });
        }
      });
    });
  } else {
    area.innerHTML = `<input type="text" id="text-answer" autocomplete="off" placeholder="Votre r√©ponse">`;
    document.getElementById("text-answer").focus();
    document.getElementById("validate-btn").style.display = "";
    document.getElementById("validate-btn").disabled = false;
    document.getElementById("next-btn").style.display = "";
    document.getElementById("continue-btn").style.display = "none";
    document.getElementById("text-answer").onkeypress = function (e) {
      if (e.key === "Enter") validateCurrent();
    };
  }
}


    function isChoiceMode(mode){
      return choiceModes.includes(mode) ||
        (currentMode.startsWith("quiz") && choiceModes.includes(currentQuizSubMode));
    }
    function getChoicesForMode(mode){
      if(mode==="fr-ar"||mode==="tr-ar") return pronouns.map(p=>p.ar);
      if(mode==="fr-tr"||mode==="ar-tr") return pronouns.map(p=>p.tr);
      return [];
    }

   function shuffle(arr) {
  // Supprime les doublons
  let uniqueArr = [...new Set(arr)];

  // M√©lange avec Fisher-Yates
  for (let i = uniqueArr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [uniqueArr[i], uniqueArr[j]] = [uniqueArr[j], uniqueArr[i]];
  }
  return uniqueArr;
}


function toggleSilentMode() {
  silentMode = !silentMode;
  const btn = document.getElementById("silent-btn");
  btn.textContent = silentMode ? "üîá" : "üîä";
}



// Ajoute ces variables globales quelque part dans ton script
let silentMode = false;
/*const goodSound = new Audio('button-3.mp3');
const badSound = new Audio('button-10.mp3');*/


const goodSound = new Audio('data:audio/mpeg;base64,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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uSwP+AAAABLAAAAAAAACWAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/7ksD/gAAAASwAAAAAAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/+5LA/4AAAAEsAAAAAAAAJYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uSwP+AAAABLAAAAAAAACWAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/7ksD/gAAAASwAAAAAAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/+5LA/4AAAAEsAAAAAAAAJYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAA//uSwP+AAAABLAAAAAAAACWAAAAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAAA==');
const badSound = new Audio('data:audio/mpeg;base64,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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uSwP+AAAABLAAAAAAAACWAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/7ksD/gAAAASwAAAAAAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/+5LA/4AAAAEsAAAAAAAAJYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uSwP+AAAABLAAAAAAAACWAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/7ksD/gAAAASwAAAAAAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/+5LA/4AAAAEsAAAAAAAAJYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uSwP+AAAABLAAAAAAAACWAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAP/7ksD/gAAAASwAAAAAAAAlgAAAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAAA=');




function playSound(isGood) {
  if (silentMode) return;
  try {
    let sound = isGood ? goodSound : badSound;
    sound.currentTime = 0;
    sound.play().catch((e) => {
      console.error("Erreur lors de la lecture du son :", e);
    });
  } catch (e) {
    console.error("Erreur globale :", e);
  }
}

function validateCurrent() {
  if (waitingNext) return;
  let mode = currentQuizSubMode || currentMode;
  let user, correct;
  if (isChoiceMode(mode)) {
    const checked = document.querySelector('input[type="checkbox"][name="choice"]:checked');
    if (!checked) {
      document.getElementById("feedback").textContent = "Choisissez une r√©ponse.";
      return;
    }
    user = checked.value;
  } else {
    user = document.getElementById("text-answer").value.trim();
    if (!user) {
      document.getElementById("feedback").textContent = "Saisissez une r√©ponse.";
      return;
    }
  }

  if (mode === "fr-ar") correct = currentQuestion.ar;
  else if (mode === "ar-fr") correct = currentQuestion.fr;
  else if (mode === "fr-tr") correct = currentQuestion.tr;
  else if (mode === "tr-fr") correct = currentQuestion.fr;
  else if (mode === "ar-tr") correct = currentQuestion.tr;
  else if (mode === "tr-ar") correct = currentQuestion.ar;
  else correct = "";

  let isGood = false;
  if (isChoiceMode(mode)) {
    isGood = clean(user) === clean(correct);
  } else {
    isGood = compareAnswers(user, correct);
  }

  showFeedback(isGood, correct, user);
  updateStats(isGood, mode, user, correct);
  playSound(isGood);
  waitingNext = true;
  document.getElementById("validate-btn").disabled = true;
  document.getElementById("next-btn").style.display = "none";
  document.getElementById("continue-btn").style.display = "";
}



function showFeedback(isGood, correct, user){
  const fb = document.getElementById("feedback");
  fb.className = "feedback " + (isGood ? "good" : "bad");
  if(isGood) {
    fb.textContent = "Bonne r√©ponse !";
    document.getElementById("validate-btn").disabled = true;
    document.getElementById("next-btn").style.display = "none";
    document.getElementById("continue-btn").style.display = "none";
    // Passage automatique √† la question suivante apr√®s 1 seconde
    setTimeout(nextQuestion, 1000);
  } else {
    fb.textContent = "Mauvaise r√©ponse. La bonne r√©ponse √©tait : " + correct;
    document.getElementById("validate-btn").disabled = true;
    document.getElementById("next-btn").style.display = "";
    document.getElementById("continue-btn").style.display = "";
  }
}


    function clean(str){
      return (str||"").normalize("NFD").replace(/[\u064B-\u065F]/g,"")
        .replace(/[^a-zA-Z\u0600-\u06FF0-9 ]/g," ")
        .replace(/\s+/g," ").trim().toLowerCase();
    }
    function compareAnswers(user, correct){
      const userSet = new Set(clean(user).split(" "));
      const correctSet = new Set(clean(correct).split(" "));
      return [...correctSet].every(word=>userSet.has(word));
    }


  /*  function playSound(isGood){
      try {
        (isGood?document.getElementById("good-audio"):document.getElementById("bad-audio")).play();
      } catch(e){}
    }*/
    function updateStats(isGood, mode, user, correct){
      if(isGood) stats.good++;
      else stats.bad++;
      stats.history.push({
        date: new Date().toISOString(),
        mode: mode,
        question: document.getElementById("question-text").textContent,
        user: user,
        correct: correct,
        result: isGood
      });
      if(stats.history.length>1000) stats.history.shift();
      localStorage.setItem("pronoun_stats", JSON.stringify(stats));
      updateStatsBar();
      drawChart();
    }
    function updateStatsBar(){
      document.getElementById("good-count").textContent = stats.good;
      document.getElementById("bad-count").textContent = stats.bad;
      const total = stats.good+stats.bad;
      const acc = total?Math.round(100*stats.good/total):0;
      document.getElementById("accuracy-label").textContent = acc+"%";
      let lvl = levelThresholds[0].label;
      let prog = 0;
      for(let i=levelThresholds.length-1;i>=0;i--){
        if(stats.good>=levelThresholds[i].min){
          lvl = levelThresholds[i].label;
          if(i<levelThresholds.length-1){
            const next = levelThresholds[i+1].min;
            prog = Math.min(100,100*(stats.good-levelThresholds[i].min)/(next-levelThresholds[i].min));
          } else prog = 100;
          break;
        }
      }
      document.getElementById("level-label").textContent = lvl;
      document.getElementById("level-progress").style.width = prog+"%";
    }
    function updateStatsPopup(){
      document.getElementById("stat-good").textContent = stats.good;
      document.getElementById("stat-bad").textContent = stats.bad;
      const total = stats.good+stats.bad;
      const acc = total?Math.round(100*stats.good/total):0;
      document.getElementById("stat-acc").textContent = acc+"%";
    }
    function drawChart(){
      if(typeof Chart==="undefined") return;
      const ctx = document.getElementById("chart").getContext("2d");
      const hist = stats.history.slice(-40);
      const labels = hist.map((h,i)=>i+1);
      const dataGood = hist.map(h=>h.result?1:0);
      const dataBad = hist.map(h=>!h.result?1:0);
      if(chart) chart.destroy();
      chart = new Chart(ctx,{
        type:"bar",
        data:{
          labels: labels,
          datasets:[
            {label:"Bonnes",data:dataGood,backgroundColor:"rgba(52,168,83,0.7)"},
            {label:"Mauvaises",data:dataBad,backgroundColor:"rgba(234,67,53,0.7)"}
          ]
        },
        options:{
          responsive:false,
          plugins:{legend:{display:true}},
          scales:{y:{beginAtZero:true,max:1,ticks:{stepSize:1}}}
        }
      });
    }
    function exportCSV(){
      let csv = "Date,Mode,Question,Utilisateur,Correct,Resultat\n";
      stats.history.forEach(h=>{
        csv += `"${h.date}","${h.mode}","${h.question}","${h.user}","${h.correct}","${h.result?'Bonne':'Mauvaise'}"\n`;
      });
      const blob = new Blob([csv],{type:"text/csv"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "stats_pronoms.csv";
      a.click();
    }
    function exportJSON(){
      const blob = new Blob([JSON.stringify(stats)],{type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "stats_pronoms.json";
      a.click();
    }
    function importJSON(evt){
      const file = evt.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = function(e){
        try {
          const obj = JSON.parse(e.target.result);
          if(!("good" in obj) || !("bad" in obj) || !Array.isArray(obj.history)){
            alert("Fichier incompatible.");
            return;
          }
          stats = obj;
          localStorage.setItem("pronoun_stats", JSON.stringify(stats));
          updateStatsBar();
          drawChart();
          updateStatsPopup();
          alert("Statistiques import√©es !");
        } catch(e){
          alert("Erreur de lecture du fichier.");
        }
      };
      reader.readAsText(file);
    }
  </script>
 <script>
  const menuToggle = document.getElementById('menu-toggle');
  const menuIcon = document.querySelector('.menu-icon');

  let autoCloseTimer = null;

  // Quand on clique sur l‚Äôic√¥ne du menu
  menuIcon.addEventListener('click', () => {
    // Petite attente pour laisser le menu s‚Äôouvrir via le CSS
    setTimeout(() => {
      if (menuToggle.checked) {
        // Si menu ouvert, lancer le minuteur
        if (autoCloseTimer) clearTimeout(autoCloseTimer); // R√©initialise si d√©j√† lanc√©
        autoCloseTimer = setTimeout(() => {
          menuToggle.checked = false; // Replier le menu
        }, 5000); // 5 secondes
      }
    }, 50); // on laisse le temps √† l‚Äô√©tat "checked" de s‚Äôactiver
  });
</script>
</body>
</html>
